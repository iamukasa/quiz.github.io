<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KCPE 2011 Science Quiz</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f4f4f4;margin:0;padding:20px}
    .quiz-container{max-width:720px;margin:auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
    .question{font-size:18px;margin-bottom:16px}
    .diagram{max-width:100%;margin-bottom:16px;border:1px solid #ccc}
    .option{display:block;padding:10px;margin-bottom:10px;border-radius:6px;background:#eee;cursor:pointer}
    .option:hover{background:#d0eaff}
    .result{font-size:20px;text-align:center;margin-top:24px}
    .leaderboard{margin-top:32px}
    .leaderboard h3{text-align:center;margin:0 0 12px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #ddd;text-align:left}
  </style>
</head>
<body>
  <div class="quiz-container">
    <div id="quiz"></div>
    <div class="result" id="result"></div>
    <div class="leaderboard" id="leaderboard"></div>
  </div>

  <script>
    let questions = [];
    let leaderboard = [];
    let current = 0;
    let score   = 0;

    /* ---------- leaderboard helpers ---------- */
    async function loadLeaderboard() {
      try {
        const res = await fetch('leaderboard.json');
        leaderboard = res.ok ? await res.json() : [];
      } catch { leaderboard = []; }
    }
    function saveLeaderboard() {
      leaderboard.sort((a,b)=>b.score-a.score);
      leaderboard = leaderboard.slice(0,10);
      const blob = new Blob([JSON.stringify(leaderboard, null, 2)],{type:'application/json'});
      const url  = URL.createObjectURL(blob);
      const link = Object.assign(document.createElement('a'),{href:url,download:'leaderboard.json'});
      link.click();
      URL.revokeObjectURL(url);
    }
    function renderLeaderboard() {
      let html = '<h3>Leaderboard (Top 10)</h3>';
      if (!leaderboard.length) {
        html += '<p>No scores yet — be the first!</p>';
      } else {
        html += '<table><tr><th>#</th><th>Name</th><th>Score</th></tr>';
        leaderboard.forEach((e,i)=>{html += `<tr><td>${i+1}</td><td>${e.name}</td><td>${e.score}</td></tr>`});
        html += '</table>';
      }
      document.getElementById('leaderboard').innerHTML = html;
    }

    /* ---------- quiz logic ---------- */
    function finishQuiz() {
      document.getElementById('quiz').innerHTML = '';
      document.getElementById('result').textContent = `Quiz complete!  Your score: ${score}/${questions.length}`;
      let name = prompt('Enter your name for the leaderboard:');
      if(!name) name = 'Anonymous';
      leaderboard.push({name,score});
      saveLeaderboard();
      renderLeaderboard();
    }
    function showQuestion() {
      if (current >= questions.length) { finishQuiz(); return; }
      const q = questions[current];
      let html = `<div class="question">${current+1}. ${q.question}</div>`;
      if (q.image) html += `<img src="${q.image}" alt="diagram" class="diagram">`;
      const wrap = document.getElementById('quiz');
      wrap.innerHTML = html;
      q.options.forEach(opt=>{
        const btn = document.createElement('div');
        btn.className = 'option';
        btn.textContent = opt;
        btn.onclick = () => { if (opt === q.answer) score++; current++; showQuestion(); };
        wrap.appendChild(btn);
      });
    }

    async function init() {
      [questions] = await Promise.all([fetch('questions.json').then(r=>r.json()), loadLeaderboard()]);
      await loadLeaderboard();
      renderLeaderboard();
      showQuestion();
    }
    init();
  </script>
</body>
</html>
